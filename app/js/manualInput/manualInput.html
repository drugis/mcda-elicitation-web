<!-- step 1 -->
<div ng-if="state.step==='step1'">
  <div class="grid-x">
    <div class="cell">
      <h3>Create workspace manually — step 1 of 2</h3>
      <h4>Define criteria and alternatives</h4>
    </div>
    <div class="cell">
      Here you can enter the data for an analysis manually. In this first step, create the criteria and alternatives you wish to
      analyse. Alternatives are simply a title, while criteria are more complex.
    </div>
  </div>
  <div class="grid-x">
    <div class="cell large-6">
      <label>Workspace title
        <input type="text" ng-model="state.title" width="100%">
      </label>
    </div>
  </div>
  <div class="grid-x">
    <div class="cell large-6">
      <label>Therapeutic context
        <inline-help help-key="therapeutic-context"></inline-help>
        <textarea ng-model="state.description" width="100%" rows="5"></textarea>
      </label>
    </div>
    <div class="cell">
      <h4>Criteria
        <inline-help help-key="criterion"></inline-help>
      </h4>
    </div>
    <div class="cell">
      <label>
        Use favorability
        <inline-help help-key="favorability"></inline-help>:
        <input type="checkbox" ng-model="state.useFavorability" ng-change="favorabilityChanged()">
      </label>
    </div>
    <div class="cell">
      <button class="button small" type="button" ng-click="openCriterionModal()">
        <i class="fa fa-plus"></i> Add Criterion</button>
    </div>
    <div class="cell callout" ng-repeat="criterion in state.criteria">
      <div class="grid-x">
        <div class="cell shrink" style="display:flex; align-items:center;">
          <div style="margin-right: 16px">
            <div style="line-height: 10px; margin-bottom: 10px;">
              <a ng-if="canCriterionGoUp(criterion, $index)" ng-click="criterionUp($index)" class="nav-arrow">
                <i style="line-height:0px;" class="fa fa-caret-up fa-2x"></i>
              </a>
              <i ng-if="!canCriterionGoUp(criterion, $index)" style="line-height:0px; color:#bbb" class="fa fa-caret-up fa-2x"></i>
            </div>
            <div style="line-height: 10px;">
              <a ng-if="canCriterionGoDown(criterion, $index)" ng-click="criterionDown($index)" class="nav-arrow">
                <i style="line-height:0px;" class="fa fa-caret-down fa-2x"></i>
              </a>
              <i ng-if="!canCriterionGoDown(criterion, $index)" style="line-height:0px; color:#bbb" class="fa fa-caret-down fa-2x"></i>
            </div>
          </div>
        </div>
        <div class="cell auto">
          <div class="grid-x">
            <div class="cell large-10">
              <h4>{{criterion.title}}</h4>
            </div>
            <div class="cell large-2">
              <div class="right">
                <a ng-click="openCriterionModal(criterion)" tooltip="Edit criterion">
                  <i class="fa fa-edit fa-2x icon-fixed-width"></i>
                </a>
                <a ng-click="removeCriterion(criterion)" tooltip="Remove criterion">
                  <i class="fa fa-trash fa-2x icon-fixed-width" style="color:red"></i>
                </a>
              </div>
            </div>
            <div class="cell" ng-if="criterion.description">
              <b>Description:</b> {{criterion.description}}
            </div>
            <div class="cell" ng-if="criterion.unitOfMeasurement">
              <b>Unit of measurement:</b> {{criterion.unitOfMeasurement}}
            </div>
            <div class="cell" ng-if="state.useFavorability">
              <b>Favorable:</b> {{criterion.isFavorable ? 'yes' : 'no'}}
            </div>
            <div class="cell">
              <button class="button small" ng-click="editDataSource(criterion)">Add data source</button>
            </div>
            <div class="cell">
              <table>
                <thead>
                  <tr>
                    <th></th>
                    <th style="min-width: 15rem;">Reference
                      <inline-help help-key="criterion-source"></inline-help>
                    </th>
                    <th>Input type</th>
                    <th>Input method</th>
                    <th>Data type</th>
                    <th>Parameter of interest</th>
                    <th>Uncertainties / Strength of evidence
                      <!-- <inline-help help-key="strength-of-evidence"></inline-help> -->
                    </th>
                    <th></th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="dataSource in criterion.dataSources track by dataSource.id">
                    <td>
                      <div style="line-height: 10px; margin-bottom: 4px;">
                        <a ng-if="$index !==0" ng-click="dataSourceUp(criterion, $index)" class="nav-arrow">
                          <i style="line-height:0px;" class="fa fa-caret-up"></i>
                        </a>
                        <i ng-if="$index === 0" style="line-height:0px; color:#bbb" class="fa fa-caret-up"></i>
                      </div>
                      <div style="line-height: 10px;">
                        <a ng-if="$index !== criterion.dataSources.length-1" ng-click="dataSourceDown(criterion, $index)" class="nav-arrow">
                          <i style="line-height:0px;" class="fa fa-caret-down"></i>
                        </a>
                        <i ng-if="$index === criterion.dataSources.length-1" style="line-height:0px; color:#bbb" class="fa fa-caret-down"></i>
                      </div>
                    </td>
                    <td>
                      <div ng-if="dataSource.sourceLink"><a href="{{dataSource.sourceLink}}">{{dataSource.source}}</a></div>
                      <div ng-if="!dataSource.sourceLink">{{dataSource.source}}<div>
                    </td>
                    <td ng-style="dataSource.inputType === 'Unknown'? {'color': 'red'} : {}">{{dataSource.inputType}}</td>
                    <td>{{dataSource.inputType === 'distribution' ? dataSource.inputMethod :'NA'}}</td>
                    <td>{{dataSource.inputType === 'effect' || dataSource.inputMethod === 'assistedDistribution' ? dataSource.dataType
                      : 'NA'}}</td>
                    <td>{{dataSource.inputType !== 'distribution' || dataSource.inputMethod === 'assistedDistribution' ? dataSource.parameterOfInterest
                      : 'NA'}}</td>
                    <td>
                      <b>Unc: </b> {{dataSource.uncertainties}}
                      <br>
                      <b>SoE: </b>{{dataSource.strengthOfEvidence}}
                    </td>
                    <td>
                      <a ng-click="editDataSource(criterion, $index)" tooltip="Edit data source">
                        <i class="fa fa-edit icon-fixed-width"></i>
                      </a>
                    </td>
                    <td>
                      <a ng-click="removeDataSource(criterion, dataSource)" tooltip="Remove data source" ng-if="criterion.dataSources.length > 1">
                        <i class="fa fa-trash icon-fixed-width" style="color:red"></i>
                      </a>
                      <a tooltip="Cannot remove the only data source" ng-if="criterion.dataSources.length < 2">
                        <i class="fa fa-trash icon-fixed-width" style="color:#bbb"></i>
                      </a>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="cell">
      <h4>Alternatives
        <inline-help help-key="alternative"></inline-help>
      </h4>
    </div>
  </div>
  <div class="grid-x">
    <div class="cell input-group large-6">
      <span class="input-group-label">
        Alternative title
      </span>
      <input class="text input-group-field" ng-model="treatmentInputField.value" onkeyup="if(event.keyCode===13) document.getElementById('treatmentButton').click()">
      <div class="input-group-button">
        <button ng-disabled="!treatmentInputField.value || isDuplicateTitle(treatmentInputField.value)" type="button" class="button tiny"
          ng-click="addAlternative(treatmentInputField.value)" id="treatmentButton">
          <i class="fa fa-plus"></i> Add Alternative</button>
      </div>
    </div>
  </div>
  <div class="grid-x">
    <div class="cell large-6">
      <table width="100%">
        <thead>
          <tr>
            <th>Alternative title</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-if="!state.alternatives.length">
            <td>
              <em>No alternatives defined</em>
            </td>
          </tr>
          <tr ng-repeat="alternative in state.alternatives">
            <td>
              <div class="grid-x">
                <div class="cell small-1">
                  <div style="line-height: 10px; margin-bottom: 4px;">
                    <a ng-click="alternativeUp($index)" class="nav-arrow" ng-if="$index !== 0">
                      <i style="line-height:0px;" class="fa fa-caret-up"></i>
                    </a>
                    <i ng-if="$index === 0" style="line-height:0px; color:#bbb" class="fa fa-caret-up"></i>
                  </div>
                  <div style="line-height: 10px;">
                    <a ng-click="alternativeDown($index)" class="nav-arrow" ng-if="$index !== state.alternatives.length-1">
                      <i style="line-height:0px;" class="fa fa-caret-down"></i>
                    </a>
                    <i ng-if="$index === state.alternatives.length-1" style="line-height:0px; color:#bbb" class="fa fa-caret-down"></i>
                  </div>
                </div>
                <div class="cell small-11">
                  <a ng-click="removeAlternative(alternative)" tooltip="Remove alternative">
                    <i class="fa fa-trash icon-fixed-width" style="color:red"></i>
                  </a> {{alternative.title}}
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="cell">
      <button class="button" ng-disabled="!state.title || state.criteria.length < 2|| state.alternatives.length < 2 ||
      hasUnknownInputType || (state.useFavorability && hasMissingFavorability)" type="button" ng-click="goToStep2()" tooltip="Enter effects table data">
        Enter data
      </button>
      <button class="button" ng-click="saveInProgress()" ng-disabled="!state.title || !dirty" tooltip="Save current state">Save</button>
    </div>
    <div class="cell" ng-if="!state.title">
      <em>Missing title</em>
    </div>
    <div class="cell" ng-if="state.criteria.length < 2">
      <em>Two criteria required</em>
    </div>
    <div class="cell" ng-if="state.alternatives.length < 2">
      <em>Two alternatives required</em>
    </div>
    <div class="cell" ng-if="hasUnknownInputType">
      <em>Criteria with unknown input type</em>
    </div>
    <div class="cell" ng-if="state.useFavorability && hasMissingFavorability">
      <em>Criteria must have favorability if favorability is turned on, once all favorabilities are set, the criteria will be
        sorted.
      </em>
    </div>
  </div>
</div>
<!-- step 2 -->
<div ng-if="state.step==='step2'">
  <div class="grid-x">
    <div class="cell">
      <h3>Create workspace manually — step 2 of 2</h3>
    </div>
    <div class="cell">
      <h4>Enter data in effects table
        <inline-help help-key="effects-table"></inline-help>
      </h4>
    </div>
    <div class="cell">
      Here you enter the data for each combination of criterion and alternative, in the form of results from studies. The corresponding
      distribution is calculated and displayed in the table. Begin entering data by clicking any of the cells' text.
    </div>
    <!-- input -->
    <div class="cell">
      <h4>{{state.title}}</h4>
    </div>
    <div class="cell">
      <table>
        <thead>
          <tr>
            <th></th>
            <th>Description</th>
            <th>Unit of measurement</th>
            <th ng-if="state.useFavorability">Is favorable?</th>
            <th>Reference</th>
            <th ng-repeat="alternative in state.alternatives" style="min-width:80px">{{alternative.title}}</th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="row in criteriaRows">
            <td ng-if="row.isFirstRow" rowspan="{{row.criterion.numberOfDataSources}}">{{row.criterion.title}}</td>
            <td ng-if="row.isFirstRow" rowspan="{{row.criterion.numberOfDataSources}}">{{row.criterion.description}}</td>
            <td ng-if="row.isFirstRow" rowspan="{{row.criterion.numberOfDataSources}}">{{row.criterion.unitOfMeasurement}}</td>
            <td ng-if="state.useFavorability && row.isFirstRow" rowspan="{{row.criterion.numberOfDataSources}}">{{row.criterion.isFavorable? 'yes' : 'no'}}</td>
            <td>{{row.dataSource.source}}</td>
            <td ng-repeat="alternative in state.alternatives">
              <effect-input-helper input-data-source="row.dataSource" alternative="alternative" input-data="state.inputData[row.dataSource.id][alternative.id]"
                change-callback="checkInputData"></effect-input-helper>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <!-- buttons -->
    <div class="cell">
      <button ng-disabled="!state.isInputDataValid" class="button" type="button" ng-click="createProblem()" tooltip="Create problem and proceed to analysis">
        Done
      </button>
      <button class="button" ng-click="saveInProgress()" ng-disabled="!dirty" tooltip="Save current state">Save</button>
      <button type="button" ng-click="goToStep1()" type="button" class="button">Back</button>
      <div ng-if="!state.isInputDataValid">
        <em>Invalid input data</em>
      </div>
    </div>
  </div>
</div>
