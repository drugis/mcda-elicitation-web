<div ng-if="!deterministicResults.problem">
  <div class="grid-x">
    <div class="cell">
      <a class="fa fa-spinner fa-2x fa-spin"></a>
    </div>
  </div>
</div>
<div ng-if="deterministicResults.problem">
  <div class="grid-x">
    <div class="cell">
      <span>Scenario:</span>
      <select id="scenario-selector" class="scenario-select" ng-model="scenario"
        ng-options="scenario.title for scenario in scenariosWithResults track by scenario.id"
        ng-change="scenarioChanged(scenario)"></select>
    </div>
  </div>
  <br>
  <sensitivity-table edit-mode="editMode" toggled-columns="toggledColumns" alternatives="alternatives"
    scenario="scenario" scales="scales" modifiable-scales="modifiableScales"
    sensitivity-scales-changed="sensitivityScalesChanged" is-editing="isEditing" criteria="criteria">
  </sensitivity-table>
  <div class="grid-x underlined-div">
    <div class="cell large-4 button-group small expanded">
      <button id="recalculate-button" class="button" ng-click="recalculateResults()"
        ng-disabled="sensitivityMeasurements.isEditing">
        Recalculate value profiles
      </button>
      <button id="reset-button" class="button" ng-click="resetSensitivityAnalysis()">
        Reset
      </button>
    </div>
  </div>
  <div class="grid-x underlined-div">
    <div class="cell large-10">
      <h4>Representative weights
        <inline-help help-key="representative-weights"></inline-help>
      </h4>
    </div>
    <div clas="cell large-2">
      <button class="button small info clipboard-button" data-clipboard-target="#representative-weights-table">
        <i class="fa fa-clipboard"></i> Copy to clipboard
      </button>
    </div>
    <div class="cell">
      <table id="representative-weights-table">
        <thead>
          <th ng-repeat="criterion in criteria">{{criterion.title}}</th>
        </thead>
        <tbody>
          <tr>
            <td id="{{criterion.id}}-weight" ng-repeat="criterion in criteria">
              {{deterministicResults.results.weights.data[criterion.id] | number}}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="grid-x underlined-div">
    <div class="cell">
      <div class="grid-x grid-margin-x">
        <div class="cell large-4">
          <h4>Total value (base case)
            <inline-help help-key="total-value"></inline-help>
          </h4>
        </div>
        <div class="cell large-2">
          <button class="button small info clipboard-button right" data-clipboard-target="#base-case-table">
            <i class="fa fa-clipboard"></i> Copy to clipboard
          </button>
        </div>
        <div ng-if="recalculatedDeterministicResults" class="cell large-4">
          <h4>Total value (recalculated case)
            <inline-help help-key="total-value"></inline-help>
          </h4>
        </div>
        <div class="cell large-2" ng-if="recalculatedDeterministicResults">
          <button class="button small info clipboard-button right" data-clipboard-target="#recalculated-case-table">
            <i class="fa fa-clipboard"></i> Copy to clipboard
          </button>
        </div>
        <div class="cell large-6" ng-if="!recalculatedDeterministicResults">
          <!-- Keep grid layout consistent  -->
        </div>
        <div class="cell large-6">
          <table id="base-case-table">
            <thead>
              <th ng-repeat="alternative in alternatives">{{scenario.state.legend[alternative.id].baseTitle ||
                alternative.title}}</th>
            </thead>
            <tbody>
              <tr>
                <td id="{{ alternative.id }}-base-case" ng-repeat="alternative in alternatives">
                  {{deterministicResults.results.total.data[alternative.id] | number}}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="cell large-6" ng-if="recalculatedDeterministicResults" ng-if="recalculatedDeterministicResults">
          <table id="recalculated-case-table">
            <thead>
              <th ng-repeat="alternative in alternatives">{{scenario.state.legend[alternative.id].baseTitle ||
                alternative.title}}</th>
            </thead>
            <tbody>
              <tr>
                <td id="{{ alternative.id }}-recalculated-case" ng-repeat="alternative in alternatives">
                  {{recalculatedDeterministicResults.results.total.data[alternative.id] | number}}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="grid-x grid-margin-x">
        <div class="cell">
          <h4>Value profiles
            <inline-help help-key="value-profiles"></inline-help>
          </h4>
        </div>
      </div>
      <div class="grid-x">
        <div class="cell large-6">
          <h5>Base case</h5>
          <div export legend file-name="'basecaseplot'">
            <value-profile-plot id="base-case-plot" values="deterministicResults.results" criteria="criteria"
              alternatives="alternatives" alternatives-legend="scenario.state.legend"></value-profile-plot>
          </div>
        </div>
        <div ng-if="recalculatedDeterministicResults" class="cell large-6">
          <h5>Recalculated case</h5>
          <div export legend file-name="'recalculatedcaseplot'">
            <value-profile-plot id="recalculated-case-plot" values="recalculatedDeterministicResults.results"
              criteria="criteria" alternatives="alternatives" alternatives-legend="scenario.state.legend">
            </value-profile-plot>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="grid-x">
    <div class="cell">
      <h4>One-way sensitivity analysis
        <inline-help help-key="one-way-sensitivity-analysis"></inline-help>
      </h4>
    </div>
  </div>
  <div class="grid-x grid-margin-x">
    <div class="cell medium-6 large-6">
      <measurement-sensitivity scenario="scenario" alternatives="alternatives" aggregate-state="aggregateState"
        criteria="criteria" edit-mode="editMode"></measurement-sensitivity>
    </div>
    <div class="cell medium-6 large-6">
      <preferences-sensitivity scenario="scenario" alternatives="alternatives" aggregate-state="aggregateState"
        criteria="criteria" edit-mode="editMode"></preferences-sensitivity>
    </div>
  </div>
</div>
